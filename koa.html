<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KOA-D 风险预警工具原型</title>
    <!-- 引入 Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* 确保 Inter 字体，提供优秀的排版 */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc;
        }
        /* 定制卡片基础样式 */
        .question-card {
            padding: 1.25rem;
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.06);
            border: 1px solid #e2e8f0;
            transition: transform 0.2s;
        }
        .question-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -4px rgba(0, 0, 0, 0.1);
        }

        /* 选项样式 */
        .radio-input {
            display: none;
        }
        .radio-label {
            padding: 12px 18px;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.3s ease-in-out;
            border: 2px solid #cbd5e1;
            text-align: center;
            flex-grow: 1;
            font-size: 15px;
            background-color: white;
            color: #475569;
        }
        .radio-input:checked + .radio-label {
            background-color: #3b82f6; /* 选中蓝色 */
            color: white;
            border-color: #3b82f6;
            transform: scale(1.02);
            box-shadow: 0 4px 8px rgba(59, 130, 246, 0.5);
        }
        .radio-label:hover:not(:has(:checked)) {
            border-color: #60a5fa;
        }

        /* 结果区域样式 */
        #resultBox {
            opacity: 0;
            transition: opacity 0.5s ease-in-out;
        }
    </style>
</head>
<body class="p-4 sm:p-10">

    <div id="app" class="max-w-4xl mx-auto bg-white p-6 sm:p-10 rounded-2xl shadow-3xl border border-gray-100">

        <h1 class="text-3xl sm:text-4xl font-extrabold text-gray-800 mb-2 border-b-4 pb-3 border-indigo-500/20">
            KOA-D 精准风险预警工具（原型 v1.0）
        </h1>
        <p class="text-gray-500 mb-8 text-base">
            基于机器学习模型的高权重因子简化评估，用于对骨关节炎（KOA）患者的抑郁共病（KOA-D）风险进行快速分级。
        </p>

        <div id="questionnaire" class="space-y-8">

            <!-- 问题组：5个核心风险因素 -->
            
            <!-- 1. 慢性疼痛程度 (最高权重临床因素) -->
            <div class="question-card bg-indigo-50">
                <label for="pain" class="block text-xl font-bold text-indigo-700 mb-4">
                    1. 慢性疼痛程度评估
                </label>
                <div id="q1_options" class="grid grid-cols-3 gap-4">
                    <input type="radio" id="pain_0" name="pain" class="radio-input" value="0" data-weight="0" checked>
                    <label for="pain_0" class="radio-label">轻微/无（VAS 0-3）</label>

                    <input type="radio" id="pain_1" name="pain" class="radio-input" value="1" data-weight="4">
                    <label for="pain_1" class="radio-label">中度疼痛（VAS 4-7）</label>

                    <input type="radio" id="pain_2" name="pain" class="radio-input" value="2" data-weight="10">
                    <label for="pain_2" class="radio-label">重度疼痛/严重影响功能（VAS 8-10）</label>
                </div>
            </div>

            <!-- 2. 社会参与度/独居状态 (最高权重社会心理因素) -->
            <div class="question-card bg-blue-50">
                <label for="social" class="block text-xl font-bold text-blue-700 mb-4">
                    2. 社会参与度与居住状态评估
                </label>
                <div id="q2_options" class="grid grid-cols-2 gap-4">
                    <input type="radio" id="social_0" name="social" class="radio-input" value="0" data-weight="0" checked>
                    <label for="social_0" class="radio-label">高参与/非独居（经常社交，与家人同住）</label>

                    <input type="radio" id="social_1" name="social" class="radio-input" value="1" data-weight="9">
                    <label for="social_1" class="radio-label">低参与/独居/丧偶（少社交，独居或与非直系亲属同住）</label>
                </div>
            </div>

            <!-- 3. 低 BMI/衰弱风险 (关键的营养和功能指标) -->
            <div class="question-card bg-green-50">
                <label for="frailty" class="block text-xl font-bold text-green-700 mb-4">
                    3. 体质指数（BMI）与非故意体重减轻
                </label>
                <div id="q3_options" class="grid grid-cols-2 gap-4">
                    <input type="radio" id="frailty_0" name="frailty" class="radio-input" value="0" data-weight="0" checked>
                    <label for="frailty_0" class="radio-label">BMI正常/超重/肥胖 (≥18.5) 且无非故意减轻</label>

                    <input type="radio" id="frailty_1" name="frailty" class="radio-input" value="1" data-weight="7">
                    <label for="frailty_1" class="radio-label">BMI过低 (＜18.5) 或近半年有非故意体重减轻</label>
                </div>
            </div>

            <!-- 4. 心血管疾病共病 (炎症负担标记) -->
            <div class="question-card bg-red-50">
                <label for="cardio" class="block text-xl font-bold text-red-700 mb-4">
                    4. 是否合并心血管疾病（如高血压、冠心病、卒中）
                </label>
                <div id="q4_options" class="grid grid-cols-2 gap-4">
                    <input type="radio" id="cardio_0" name="cardio" class="radio-input" value="0" data-weight="0" checked>
                    <label for="cardio_0" class="radio-label">否</label>

                    <input type="radio" id="cardio_1" name="cardio" class="radio-input" value="1" data-weight="8">
                    <label for="cardio_1" class="radio-label">是（合并心血管疾病）</label>
                </div>
            </div>

            <!-- 5. 消化系统疾病共病 (肠-脑轴机制) -->
            <div class="question-card bg-yellow-50">
                <label for="digestive" class="block text-xl font-bold text-yellow-700 mb-4">
                    5. 是否合并消化系统疾病（如胃炎、消化道溃疡、肠易激）
                </label>
                <div id="q5_options" class="grid grid-cols-2 gap-4">
                    <input type="radio" id="digestive_0" name="digestive" class="radio-input" value="0" data-weight="0" checked>
                    <label for="digestive_0" class="radio-label">否</label>

                    <input type="radio" id="digestive_1" name="digestive" class="radio-input" value="1" data-weight="6">
                    <label for="digestive_1" class="radio-label">是（合并消化系统疾病）</label>
                </div>
            </div>

        </div>

        <button id="calculateBtn" class="w-full mt-10 py-4 bg-indigo-600 text-white font-extrabold text-xl rounded-xl shadow-lg hover:bg-indigo-700 transition duration-300 transform hover:scale-[1.005] hover:shadow-2xl">
            点击评估风险等级
        </button>

        <!-- 结果展示区域 -->
        <div id="resultBox" class="mt-10 p-8 rounded-2xl shadow-xl border-t-4 hidden" style="border-color: #3b82f6;">
            <h2 class="text-2xl font-bold mb-4 text-gray-800 border-b pb-2">评估结果与干预建议</h2>
            
            <div id="riskLevel" class="text-3xl font-extrabold mb-3"></div>
            <div id="riskScore" class="text-xl font-semibold mb-4 text-gray-600"></div>
            
            <p id="recommendation" class="text-gray-700 leading-relaxed text-lg"></p>
        </div>

        <p class="text-center text-sm text-gray-400 mt-10 pt-4 border-t border-gray-100">
            开发人员信息：谢娟（安徽建筑大学），李海龙（阜阳市第二人民医院），李春（合肥市第一人民医院） | 原型工具，非临床诊断用途
        </p>

    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const calculateBtn = document.getElementById('calculateBtn');
            const questionnaire = document.getElementById('questionnaire');
            const resultBox = document.getElementById('resultBox');
            const riskScoreDisplay = document.getElementById('riskScore');
            const riskLevelDisplay = document.getElementById('riskLevel');
            const recommendationDisplay = document.getElementById('recommendation');

            // 风险等级阈值 (总分范围：0 到 10 + 9 + 7 + 8 + 6 = 40)
            const MAX_SCORE = 40;
            const THRESHOLDS = {
                LOW: 15,       // 低风险到中风险的临界点
                MEDIUM: 25,    // 中风险到高风险的临界点
            };

            calculateBtn.addEventListener('click', () => {
                let totalScore = 0;

                // 遍历所有问题组，计算总分
                const questionGroups = ['pain', 'social', 'frailty', 'cardio', 'digestive'];
                
                questionGroups.forEach(groupName => {
                    const selected = questionnaire.querySelector(`input[name="${groupName}"]:checked`);
                    if (selected) {
                        const weight = parseInt(selected.getAttribute('data-weight') || 0);
                        totalScore += weight;
                    }
                });

                // 确定风险等级、颜色和建议
                let level, color, recommendationText, borderColor;

                if (totalScore >= THRESHOLDS.MEDIUM) {
                    level = '高风险 (High Risk)';
                    color = 'text-red-600';
                    borderColor = '#dc2626'; // Red-600
                    recommendationText = `**极高风险**。该患者应被视为 KOA-D 高危人群。**建议立即转诊**至医联体或上级医院的**多学科协作（MDT）门诊**，进行疼痛科、康复科、心理科的联合评估与整合干预。`;
                } else if (totalScore >= THRESHOLDS.LOW) {
                    level = '中风险 (Medium Risk)';
                    color = 'text-yellow-600';
                    borderColor = '#f59e0b'; // Yellow-600
                    recommendationText = `**中度风险**。该患者应纳入基层医疗机构的 KOA **重点管理对象**。建议加强社区社工的**社会支持干预**和**个性化运动康复指导**，并定期（每季度）使用专业量表评估抑郁症状。`;
                } else {
                    level = '低风险 (Low Risk)';
                    color = 'text-green-600';
                    borderColor = '#10b981'; // Green-600
                    recommendationText = `**低风险**。可维持常规的 KOA 慢病管理。建议进行健康教育，指导患者保持积极的社交和体力活动，并监测疼痛或共病状态，以进行早期干预。`;
                }

                // 更新结果展示
                riskScoreDisplay.textContent = `总风险权重分：${totalScore} / ${MAX_SCORE}`;
                riskLevelDisplay.className = `text-3xl font-extrabold mb-3 ${color}`;
                riskLevelDisplay.textContent = `风险等级：${level}`;
                recommendationDisplay.innerHTML = recommendationText;
                
                // 显示结果区域并设置颜色
                resultBox.style.borderColor = borderColor;
                resultBox.classList.remove('hidden');
                setTimeout(() => { resultBox.style.opacity = 1; }, 10); // 确保动画生效
                
                // 滚动到结果区域
                resultBox.scrollIntoView({ behavior: 'smooth', block: 'start' });
            });
        });
    </script>
</body>
</html>
